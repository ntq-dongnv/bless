<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nhận dạng chữ viết tay từ ảnh</title>
</head>
<body>
  <h1>Nhận dạng chữ viết tay từ ảnh</h1>
  <input type="file" id="file-input" accept="image/*" />
  <button id="predict">Nhận dạng</button>
  <p>Kết quả: <span id="result"></span></p>
  <canvas id="canvas" width="28" height="28" style="display:none;"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script>
    const fileInput = document.getElementById('file-input');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const resultElement = document.getElementById('result');
    const predictButton = document.getElementById('predict');

    let imageLoaded = false;

    // Xử lý ảnh khi người dùng tải lên
    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const img = new Image();
      img.onload = () => {
        // Resize ảnh về kích thước 28x28 và vẽ lên canvas
        ctx.drawImage(img, 0, 0, 28, 28);
        imageLoaded = true;
      };
      img.src = URL.createObjectURL(file);
    });

    // Nhận dạng ảnh
    async function predict() {
      if (!imageLoaded) {
        alert('Vui lòng tải lên một ảnh!');
        return;
      }

      // Load mô hình TensorFlow đã huấn luyện
      const model = await tf.loadLayersModel('https://storage.googleapis.com/tfjs-models/tfjs/mnist_model/model.json');

      // Lấy dữ liệu ảnh từ canvas
      const imgData = ctx.getImageData(0, 0, 28, 28);
      const imgTensor = tf.browser.fromPixels(imgData, 1) // Chuyển thành grayscale
        .toFloat()
        .div(255.0)                                      // Chuẩn hóa
        .expandDims(0);                                  // Thêm batch dimension

      // Dự đoán
      const prediction = model.predict(imgTensor);
      const predictedIndex = prediction.argMax(1).dataSync()[0];

      // Hiển thị kết quả
      resultElement.innerText = predictedIndex;
    }

    predictButton.addEventListener('click', predict);
  </script>
</body>
</html>
